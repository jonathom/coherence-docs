#!/bin/sh

export PYSPARK_PYTHON=/usr/bin/python3.6

zip -r histogram.zip histogram/

spark-submit --master yarn --deploy-mode=cluster \
--conf spark.yarn.appMasterEnv.YARN_CONTAINER_RUNTIME_DOCKER_MOUNTS=/var/lib/sss/pipes:/var/lib/sss/pipes:rw,/usr/hdp/current/:/usr/hdp/current/:ro,/etc/hadoop/conf/:/etc/hadoop/conf/:ro,/etc/krb5.conf:/etc/krb5.conf:ro,/var/lib/sss/pubconf/krb5.include.d:/var/lib/sss/pubconf/krb5.include.d:ro \
--conf spark.yarn.appMasterEnv.YARN_CONTAINER_RUNTIME_TYPE=docker \
--conf spark.yarn.appMasterEnv.YARN_CONTAINER_RUNTIME_DOCKER_IMAGE=vito-docker.artifactory.vgt.vito.be/esa-snap-gdal:0.0.5 \
--conf spark.executorEnv.YARN_CONTAINER_RUNTIME_TYPE=docker \
--conf spark.executorEnv.YARN_CONTAINER_RUNTIME_DOCKER_IMAGE=vito-docker.artifactory.vgt.vito.be/esa-snap-gdal:0.0.5 \
--conf spark.executorEnv.YARN_CONTAINER_RUNTIME_DOCKER_MOUNTS=/var/lib/sss/pipes:/var/lib/sss/pipes:rw,/usr/hdp/current/:/usr/hdp/current/:ro,/etc/hadoop/conf/:/etc/hadoop/conf/:ro,/etc/krb5.conf:/etc/krb5.conf:ro,/data/MTDA/TIFFDERIVED/PROBAV_L3_S1_TOC_333M:/data/MTDA/TIFFDERIVED/PROBAV_L3_S1_TOC_333M:ro,/data/MTDA/CGS_S1/CGS_S1_SLC_L1/IW/DV:/data/MTDA/CGS_S1/CGS_S1_SLC_L1/IW/DV:ro,/data/users/Public/jonathanbahlmann:/data/users/Public/jonathanbahlmann:rw \
--conf spark.shuffle.service.enabled=true --conf spark.dynamicAllocation.enabled=true \
--py-files histogram.zip,certifi-2021.10.8-py2.py3-none-any.whl,charset_normalizer-2.0.10-py3-none-any.whl,cycler-0.11.0-py3-none-any.whl,dill-0.3.4-py2.py3-none-any.whl,GeoAlchemy2-0.10.2-py2.py3-none-any.whl,greenlet-1.1.2-cp36-cp36m-manylinux_2_17_x86_64.manylinux2014_x86_64.whl,idna-3.3-py3-none-any.whl,importlib_metadata-4.8.3-py3-none-any.whl,kiwisolver-1.3.1-cp36-cp36m-manylinux1_x86_64.whl,matplotlib-3.3.4-cp36-cp36m-manylinux1_x86_64.whl,multiprocess-0.70.12.2-py36-none-any.whl,numpy-1.19.5-cp36-cp36m-manylinux2010_x86_64.whl,packaging-21.3-py3-none-any.whl,pathos-0.2.8-py2.py3-none-any.whl,Pillow-8.4.0-cp36-cp36m-manylinux_2_17_x86_64.manylinux2014_x86_64.whl,pox-0.3.0-py2.py3-none-any.whl,ppft-1.6.6.4-py3-none-any.whl,progressbar2-3.55.0-py2.py3-none-any.whl,psycopg2-2.7.7-cp36-cp36m-manylinux1_x86_64.whl,pyparsing-3.0.7-py3-none-any.whl,python_dateutil-2.8.2-py2.py3-none-any.whl,python_utils-3.1.0-py2.py3-none-any.whl,PyYAML-6.0-cp36-cp36m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl,requests-2.27.1-py2.py3-none-any.whl,six-1.16.0-py2.py3-none-any.whl,spatialist-0.9.0-py3-none-any.whl,SQLAlchemy-1.4.31-cp36-cp36m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl,SQLAlchemy_Utils-0.38.2-py3-none-any.whl,tblib-1.7.0-py2.py3-none-any.whl,typing_extensions-4.0.1-py3-none-any.whl,urllib3-1.26.8-py2.py3-none-any.whl,zipp-3.6.0-py3-none-any.whl,pyroSAR-0.15.1-py3-none-any.whl spark.py